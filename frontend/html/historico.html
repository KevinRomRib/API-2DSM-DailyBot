<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/css/historico.css">

    <title>Histórico</title>
</head>

<body>
    <section>
        <h1>Histórico:</h1>
        <div class="principal">

            <!-- Cabeçalho -->
            <div class="cabecalho-historico">
                <p id="nome"></p>
                <p id="email"></p>
                <input type="button" value="Ver mais" class="botao-modal" onclick="abrir()">
            </div>
            <hr>

            <!-- Modal -->
            <div class="container">
                <div class="modal">
                    <div class="botao-fechar">
                        <button class="fechar" onclick="fechar()">&times;</button>
                    </div>
                    <p class="modal-historico" id="modal-nome"></p>
                    <p class="modal-historico" id="modal-email"></p>
                    <p class="modal-historico" id="modal-cpf"></p>
                </div>
            </div>

            <!-- Data e link -->
            <div class="conteudo" id="conteudoProcessos">

            </div>
        </div>
    </section>

    <script>

        function abrir() {
            document.querySelector('.modal').classList.add('show')
        }

        function fechar() {
            document.querySelector('.modal').classList.remove('show')
        }

    </script>
    <script>
        (async function getContent() {
            var id;
            const url = document.URL;
            var res = window.location.pathname.match(/^\/historico\/(\d+)/);
            if (res.length == 2) {
                var id = res[1];
            }
            const user = await fetch(`http://localhost:7071/associados/${id}`);
            const associado = await user.json();
            const userProcessos = await fetch(`http://localhost:7071/processos/users/${id}`);
            const processoAssociados = await userProcessos.json();
            console.log(processoAssociados);
            listagemProcessos(processoAssociados, associado);
        })();
        function listagemProcessos(processos, associado) {

            let output = ''
            let outputNome = `Nome: <span class="subtitulo">${associado.nome} </span>`;
            let outputNomeModal = `Nome:<span class="subtitulo"> ${associado.nome}</span>`
            let outputEmailModal = `E-mail:<span class="subtitulo"> ${associado.email}</span>`
            let outputCPFModal = `CPF:<span class="subtitulo"> ${associado.cpf} </span>`
            let outputEmail = `E-mail: <span class="subtitulo">${associado.email}</span>`;
            for (let i = 0; i < processos.length; i++) {
                output += `<a href="${processos[i].conteudo}"><p class="informacoes" id="subtitulo">link ${i + 1}</p> </a>`
            }
            // for (let [processo, index] of processos.entries()) {
            //     output += `<a href="${processo.conteudo}"><p class="informacoes" id="subtitulo">link ${index}</p> </a>`
            // }

            document.getElementById('conteudoProcessos').innerHTML = output;
            document.getElementById('nome').innerHTML = outputNome;
            document.getElementById('email').innerHTML = outputEmail;

            document.getElementById('modal-nome').innerHTML = outputNomeModal;
            document.getElementById('modal-email').innerHTML = outputEmailModal;
            document.getElementById('modal-cpf').innerHTML = outputCPFModal;
        }


















        // let url = "http://localhost:3000/historico/:id"
        // async function getUser(link) {
        //     const user = await fetch(link);
        //     console.log(user.data)
        // }
        // console.log(getUser(url));
        // const search = new URL(document.currentScript.src).search.substring(1)
        // const stringPreparation = decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g, '":"')
        // const qs = JSON.parse('{"' + stringPreparation + '"}')




        // (async function getContent() {
        //     try {
        //         const response = await fetch('http://localhost:7071/associados');
        //         const associados = await response.json();
        //         console.log(associados);

        //         listagemUsuarios(associados);
        //     } catch (error) {
        //         console.error(error);
        //     }
        // })();


        // function listagemUsuarios(associados) {
        //     // var divNova = document.createElement("div");

        //     let output = ''
        //     for (let associado of associados) {
        //         output += `<a href = "/historico/${associado.id}"><li class="titulo-pesquisa">${associado.nome}</li></a>`
        //     }

        //     document.getElementById('ulNomes').innerHTML = output;

            // associados.forEach((associado) => {
            //     var ulNova = document.createElement("ul");
            // })
            // var liNova = document.createElement("li");
            // divNova.appendChild(ulNova);

            // associados.forEach((associado) => {
            //     ulNova.appendChild(liNova);
            //     li.innerHTML = associado.nome;
            // })
            // divAtual = document.getElementById("divNomes");
            // document.body.insertAfter(divNova, divAtual.nextSibling);
        // }
    </script>

</body>

</html>